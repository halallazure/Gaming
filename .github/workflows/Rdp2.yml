name: GitHub-Gaming-16GB-With-ID-Fix
on: workflow_dispatch

jobs:
  build:
    runs-on: windows-latest
    steps:
    - name: 1. Install & Force ID Generation
      run: |
        # Download and Install to the path we know works
        curl.exe -L -o anydesk.exe https://download.anydesk.com/AnyDesk.exe
        ./anydesk.exe --install C:\AnyDesk --start-with-win --silent
        Start-Sleep -Seconds 15

        # Set the Password
        $Password = "GitHub@2026"
        echo $Password | & "C:\AnyDesk\AnyDesk.exe" --set-password

        # Restart Service to force ID registration
        taskkill /F /IM AnyDesk.exe /T 2>$null
        Start-Process "C:\AnyDesk\AnyDesk.exe" --service
        Start-Sleep -Seconds 20
      shell: pwsh

    - name: 2. The ID Finder (Repeats until found)
      run: |
        Write-Host "Waiting for AnyDesk ID to generate..." -ForegroundColor Yellow
        $AnyDeskID = ""
        $attempt = 0
        
        # Loop up to 10 times to find the ID
        while (-not $AnyDeskID -and $attempt -lt 10) {
            $AnyDeskID = & "C:\AnyDesk\AnyDesk.exe" --get-id
            if (-not $AnyDeskID) {
                Start-Sleep -Seconds 5
                $attempt++
            }
        }

        $PublicIP = curl.exe -s https://api.ipify.org
        
        Write-Host "------------------------------------------------" -ForegroundColor Green
        Write-Host "FOR LG TV (IP): $PublicIP" -ForegroundColor Cyan
        if ($AnyDeskID) {
          Write-Host "FOR TABLET (ID): $AnyDeskID" -ForegroundColor Yellow
        } else {
          Write-Host "ID ERROR: Please check AnyDesk service status" -ForegroundColor Red
        }
        Write-Host "PASSWORD: GitHub@2026" -ForegroundColor White
        Write-Host "RAM: 16 GB ACTIVE" -ForegroundColor Green
        Write-Host "------------------------------------------------" -ForegroundColor Green
      shell: pwsh

    - name: 3. Gaming Tweak & Keep Alive
      run: |
        # Force 60FPS for your TV
        reg add "HKLM\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v "DWMFRAMEINTERVAL" /t REG_DWORD /d 15 /f
        while($true){ Start-Sleep -Seconds 60 }
      shell: pwsh
