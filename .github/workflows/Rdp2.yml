name: AnyDesk-Final-Force-2026
on: workflow_dispatch

jobs:
  build:
    runs-on: windows-latest # Public repo will automatically give 16GB
    steps:
    - name: 1. Install & Force Service
      run: |
        curl.exe -L -o anydesk.exe https://download.anydesk.com/AnyDesk.exe
        ./anydesk.exe --install C:\AnyDesk --start-with-win --silent
        Start-Sleep -Seconds 15
      shell: pwsh

    - name: 2. Registry Password Injection (The Fix)
      run: |
        # Stop AnyDesk to edit settings
        taskkill /F /IM AnyDesk.exe /T 2>$null
        net stop AnyDesk 2>$null
        
        # This is the "Magic" code that enables Unattended Access without clicking "Accept"
        $PassHash = "962260656a8161476906236316278891" # This is the hash for 'GitHub@2026'
        $RegPath = "HKLM:\SOFTWARE\WOW6432Node\AnyDesk"
        if (!(Test-Path $RegPath)) { New-Item -Path $RegPath -Force }
        Set-ItemProperty -Path $RegPath -Name "ad_anynet_id" -Value "" 
        
        # Force the Unattended Password into the system config file
        $ConfigPath = "C:\ProgramData\AnyDesk\system.conf"
        "ad.anynet.pwd_hash=$PassHash" | Out-File -FilePath $ConfigPath -Append -Encoding ascii
        "ad.anynet.pwd_salt=00000000000000000000000000000000" | Out-File -FilePath $ConfigPath -Append -Encoding ascii
        
        # Restart Service
        Start-Process "C:\AnyDesk\AnyDesk.exe" --service
        Start-Sleep -Seconds 20
      shell: pwsh

    - name: 3. THE REVEAL
      run: |
        $ID = Select-String -Path "C:\ProgramData\AnyDesk\system.conf" -Pattern "ad.anynet.id=(.*)" | ForEach-Object { $_.Matches.Groups[1].Value }
        $PublicIP = curl.exe -s https://api.ipify.org
        Write-Host "------------------------------------------------" -ForegroundColor Green
        Write-Host "ANYDESK ID: $ID" -ForegroundColor Yellow
        Write-Host "LG TV IP: $PublicIP" -ForegroundColor Cyan
        Write-Host "PASSWORD: GitHub@2026" -ForegroundColor White
        Write-Host "------------------------------------------------" -ForegroundColor Green
      shell: pwsh

    - name: 4. Keep Alive
      run: while($true){ Start-Sleep -Seconds 60 }
