name: AnyDesk-Gaming-VM
on: workflow_dispatch
jobs:
  build:
    runs-on: windows-latest
    steps:
    - name: Connect to Tailscale
      uses: tailscale/github-action@v2  # Uses the official automated method
      with:
        authkey: ${{ secrets.TAILSCALE_AUTHKEY }}
        
    - name: Setup AnyDesk & Parsec
      shell: pwsh
      run: |
        $ProgressPreference = 'SilentlyContinue'
        # Download and Start AnyDesk
        curl.exe -L -o anydesk.exe https://download.anydesk.com/AnyDesk.exe
        Start-Process .\anydesk.exe
        Start-Sleep -Seconds 10
        
        # Set Password: Gaming123
        echo "Gaming123" | .\anydesk.exe --set-password
        
        # Display ID in logs (Wait for it to generate)
        Start-Sleep -Seconds 20
        Write-Host "-------------------------------------------"
        $anyid = & .\anydesk.exe --get-id
        Write-Host "YOUR ANYDESK ID IS: $anyid"
        Write-Host "-------------------------------------------"

    - name: Keep Alive (6 Hours)
      run: |
        Write-Host "VM is now ONLINE. Check Tailscale Dashboard!"
        $i = 0
        while($i -lt 360) {
          Start-Sleep -Seconds 60
          $i++
        }
