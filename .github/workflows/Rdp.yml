name: AnyDesk-Force-MSI
on: workflow_dispatch
jobs:
  build:
    runs-on: windows-latest
    steps:
    - name: 1. Nuke and Force-Install MSI
      run: |
        # Stop any old processes
        taskkill /F /IM AnyDesk.exe /T 2>$null
        
        # Download the MSI version (Better for 2026 Virtual Machines)
        curl.exe -L -o anydesk.msi https://download.anydesk.com/AnyDesk.msi
        
        # Force install silently
        msiexec.exe /i anydesk.msi /qn /norestart
        Start-Sleep -Seconds 15
      shell: pwsh

    - name: 2. Configure Service & Password
      run: |
        $AD_PATH = "C:\Program Files (x86)\AnyDeskMSI\AnyDeskMSI.exe"
        & $AD_PATH --set-password MySafePassword123!
        Start-Sleep -Seconds 20
      shell: pwsh

    - name: 3. THE REVEAL (Fast Loop)
      run: |
        $AD_PATH = "C:\Program Files (x86)\AnyDeskMSI\AnyDeskMSI.exe"
        Write-Host "Forcing ID Generation..." -ForegroundColor Yellow
        
        for ($i=1; $i -le 10; $i++) {
            $ID = & $AD_PATH --get-id
            if ($ID) {
                Write-Host "------------------------------------------------" -ForegroundColor Green
                Write-Host "SUCCESS! YOUR ANYDESK ID: $ID" -ForegroundColor Cyan
                Write-Host "PASSWORD: MySafePassword123!" -ForegroundColor Yellow
                Write-Host "------------------------------------------------" -ForegroundColor Green
                break
            }
            Write-Host "Handshake in progress... Attempt $i/10"
            Start-Sleep -Seconds 10
        }
      shell: pwsh

    - name: 4. Keep Alive
      run: while($true){ Start-Sleep -Seconds 60 }
