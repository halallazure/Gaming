name: Connect-RDP
on: workflow_dispatch
jobs:
  build:
    runs-on: windows-latest
    steps:
    - name: 1. Download & Prepare
      run: |
        curl.exe -L -o anydesk.exe https://download.anydesk.com/AnyDesk.exe
        # Move it to a safe place we can always find
        mkdir C:\AD
        move anydesk.exe C:\AD\anydesk.exe

    - name: 2. Set Password (Piped)
      run: |
        echo "MySafePassword123!" | C:\AD\anydesk.exe --set-password
      shell: pwsh

    - name: 3. Start Service & Reveal ID
      run: |
        # Start in background to generate the ID
        Start-Process -FilePath "C:\AD\anydesk.exe" -ArgumentList "--service"
        Start-Sleep -Seconds 20
        
        # Get ID from the file (the most reliable way in 2026)
        $confPath = "$env:AppData\AnyDesk\system.conf"
        if (Test-Path $confPath) {
            $ID = Select-String -Path $confPath -Pattern "ad.anynet.id=(.*)" | ForEach-Object { $_.Matches.Groups[1].Value }
        } else {
            $ID = "Waiting... Try re-running the Get ID step."
        }
        
        Write-Host "------------------------------------------------" -ForegroundColor Green
        Write-Host "YOUR ANYDESK ID: $ID" -ForegroundColor Cyan
        Write-Host "YOUR PASSWORD: MySafePassword123!" -ForegroundColor Yellow
        Write-Host "------------------------------------------------" -ForegroundColor Green
      shell: pwsh

    - name: 4. Keep Alive
      run: while($true){ Start-Sleep -Seconds 60 }
