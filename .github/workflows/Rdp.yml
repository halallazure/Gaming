name: Connect-RDP
on: workflow_dispatch
jobs:
  build:
    runs-on: windows-2022 # Using 2022 for better compatibility
    steps:
    - name: Download AnyDesk
      run: curl.exe -L -o anydesk.exe https://download.anydesk.com/AnyDesk.exe

    - name: Start AnyDesk and Set Password
      run: |
        ./anydesk.exe --install C:\AnyDesk --start-with-win --silent
        echo "MySafePassword123!" | C:\AnyDesk\AnyDesk.exe --set-password
      shell: pwsh

    - name: REVEAL ANYDESK ID
      run: |
        Start-Sleep -Seconds 20
        # Method: Read directly from the Registry
        $RegistryPath = "HKLM:\SOFTWARE\WOW6432Node\AnyDesk"
        $ID = (Get-ItemProperty -Path $RegistryPath).ad_anynet_id
        
        Write-Host "------------------------------------------------" -ForegroundColor Green
        if ($ID) {
            Write-Host "YOUR ANYDESK ID IS: $ID" -ForegroundColor Cyan
        } else {
            # Backup: Check the system.conf file
            $ID_FILE = Select-String -Path "$env:ProgramData\AnyDesk\system.conf" -Pattern "ad.anynet.id=(.*)" | ForEach-Object { $_.Matches.Groups[1].Value }
            Write-Host "YOUR ANYDESK ID IS: $ID_FILE" -ForegroundColor Cyan
        }
        Write-Host "YOUR PASSWORD IS: MySafePassword123!" -ForegroundColor Yellow
        Write-Host "------------------------------------------------" -ForegroundColor Green
      shell: pwsh

    - name: Keep Alive
      run: while($true){ Start-Sleep -Seconds 60 }
