name: AnyDesk-Final-Force
on: workflow_dispatch
jobs:
  build:
    runs-on: windows-latest
    steps:
    - name: 1. Install AnyDesk MSI
      run: |
        # Download and install silently
        curl.exe -L -o anydesk.msi https://download.anydesk.com/AnyDesk.msi
        msiexec.exe /i anydesk.msi /qn
        Start-Sleep -Seconds 30
      shell: pwsh

    - name: 2. Find AnyDesk & Set Password
      run: |
        # Search for the EXE to avoid 'Not Recognized' errors
        $AD = (Get-ChildItem -Path "C:\Program Files*" -Filter "AnyDesk.exe" -Recurse -ErrorAction SilentlyContinue).FullName | Select-Object -First 1
        if (!$AD) { $AD = "anydesk.exe" } # Fallback
        
        Write-Host "Found AnyDesk at: $AD" -ForegroundColor Cyan
        echo "MySafePassword123!" | & $AD --set-password
        & $AD --service &
        Start-Sleep -Seconds 30
      shell: pwsh

    - name: 3. THE REVEAL (Registry + File + CLI)
      run: |
        Write-Host "Searching all locations for your ID..." -ForegroundColor Yellow
        
        # Method 1: Registry (Most reliable in 2026)
        $RegID = (Get-ItemProperty -Path "HKLM:\SOFTWARE\WOW6432Node\AnyDesk" -ErrorAction SilentlyContinue).ad_anynet_id
        
        # Method 2: System Config File
        $fileID = Select-String -Path "C:\ProgramData\AnyDesk\system.conf" -Pattern "ad.anynet.id=(.*)" -ErrorAction SilentlyContinue | ForEach-Object { $_.Matches.Groups[1].Value }
        
        Write-Host "------------------------------------------------" -ForegroundColor Green
        if ($RegID) { Write-Host "ANYDESK ID (REG): $RegID" -ForegroundColor Cyan }
        if ($fileID) { Write-Host "ANYDESK ID (FILE): $fileID" -ForegroundColor Cyan }
        Write-Host "PASSWORD: MySafePassword123!" -ForegroundColor Yellow
        Write-Host "------------------------------------------------" -ForegroundColor Green
      shell: pwsh

    - name: 4. Keep Alive
      run: while($true){ Start-Sleep -Seconds 60 }
